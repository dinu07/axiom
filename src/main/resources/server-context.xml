<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:camel="http://activemq.apache.org/camel/schema/spring"
       xmlns:broker="http://activemq.apache.org/schema/core" xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
        http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd
        http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core-5.1.0.xsd http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd">

    <!-- let Spring do its IoC stuff in this package -->
    <context:component-scan base-package="com.bt.axiom"/>

    <!-- declare a camel context that scans for classes that is RouteBuilder
         in the package org.apache.camel.example.server -->
    <camel:camelContext id="camel" autowireRouteBuilders="false" useJmx="true">
        <!-- enable JMX connector so we can connect to the server and browse mbeans -->
        <!-- Camel will log at INFO level the service URI to use for connecting with jconsole -->
        <camel:jmxAgent id="agent" createConnector="true" />
    </camel:camelContext>

    <lang:jruby id="script-evaluator"
        script-source="classpath:ruby/route_builder.rb"
        script-interfaces="org.axiom.management.RouteConfigurationScriptEvaluator">
    </lang:jruby>

    <bean id="control-channel-processor"
          scope="singleton"
          class="org.axiom.management.ControlChannelProcessor">
        <!-- some IDE integration may not recognise that
            'camel' is a valid bean name - just ignore this for now -->
        <constructor-arg ref="camel" type="org.apache.camel.CamelContext" />
        <constructor-arg ref="script-evaluator"
            type="org.axiom.management.RouteConfigurationScriptEvaluator" />
    </bean>

    <!-- lets configure the ActiveMQ JMS broker server to listen on TCP 61616 -->
    <!--<broker:broker useJmx="false" persistent="false" brokerName="localhost">
        <broker:transportConnectors>
            <broker:transportConnector name="tcp" uri="tcp://localhost:61616"/>
        </broker:transportConnectors>
    </broker:broker>-->
    
    <!-- configure the Camel JMS consumer to use the ActiveMQ broker declared above -->
    <!--<bean id="jms" class="org.apache.camel.component.jms.JmsComponent">
        <property name="connectionFactory">
            <bean class="org.apache.activemq.ActiveMQConnectionFactory">
                --><!-- use the vm protocol as the JMS broker is running in the same jvm as Camel --><!--
                <property name="brokerURL" value="vm://localhost"/>
            </bean>
        </property>
    </bean>-->

</beans>
